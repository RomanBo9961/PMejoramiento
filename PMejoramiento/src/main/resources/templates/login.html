<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Iniciar Sesión</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body class="login-body">
	<!-- VIDEO DE FONDO -->
	<video autoplay muted loop id="bg-video" class="login-video">
		<source src="https://videos.pexels.com/video-files/34645139/14683902_2560_1440_30fps.mp4" type="video/mp4">
	</video>

	<div class="login-overlay"></div>

	<!-- BOTÓN MODO DÍA/NOCHE -->
	<button class="login-theme-toggle" id="themeToggle" title="Cambiar tema">
		<i class="bi bi-moon-stars-fill"></i>
	</button>

	<!-- TARJETA DE LOGIN -->
	<div class="d-flex justify-content-center align-items-center vh-100">
		<div class="login-card">
			<h3 class="mb-4">Aszesco<i class="bi bi-person-badge"></i></h3>
			<h6><i>Ingrese sus datos para continuar</i>
			</h6>

			<form method="post" th:action="@{/login}">
				<div class="mb-3">
					<input type="text" name="username" class="form-control login-form-control" placeholder="Email"
						required>
				</div>
				<div class="mb-3">
					<input type="password" name="password" class="form-control login-form-control"
						placeholder="Contraseña" required>
				</div>

				<button type="submit" class="btn btn-login w-100 mb-3">
					<i class="bi bi-box-arrow-in-right me-1"></i> Iniciar Sesión
				</button>

				<p class="mb-4 login-text-muted">
					¿No tiene cuenta? <a th:href="@{/registro}"><Strong>Regístrese
							aquí</Strong></a>
				</p>
			</form>

			<!-- Thymeleaf "flags" ocultos -->
			<input type="hidden" id="loginError" th:if="${param.error}" value="1">
			<input type="hidden" id="logoutOk" th:if="${param.logout}" value="1">
			<input type="hidden" id="registroOk" th:if="${param.registroExitoso}" value="1">
		</div>
	</div>

	<script>
		// ====== MODO DÍA / NOCHE ======
		const toggle = document.getElementById('themeToggle');
		const icon = toggle.querySelector('i');
		const body = document.body;
		const video = document.getElementById('bg-video');

		// Guardar modo en localStorage
		if (localStorage.getItem('theme') === 'light') {
			body.classList.add('light-mode');
			icon.classList.replace('bi-moon-stars-fill', 'bi-brightness-high-fill');
			video.style.filter = "brightness(1.1)";
		}

		toggle.addEventListener('click', () => {
			body.classList.toggle('light-mode');
			if (body.classList.contains('light-mode')) {
				icon.classList.replace('bi-moon-stars-fill', 'bi-brightness-high-fill');
				localStorage.setItem('theme', 'light');
				video.style.filter = "brightness(1.1)";
			} else {
				icon.classList.replace('bi-brightness-high-fill', 'bi-moon-stars-fill');
				localStorage.setItem('theme', 'dark');
				video.style.filter = "brightness(0.7)";
			}
		});

		// ====== SWEETALERT2 SEGÚN THYMELEAF ======
		document.addEventListener("DOMContentLoaded", () => {
			if (document.getElementById("loginError")) {
				Swal.fire({
					icon: 'error',
					title: 'Error de autenticación',
					text: 'Email o contraseña incorrectos.',
					confirmButtonColor: '#3f72af'
				});
			}
			if (document.getElementById("logoutOk")) {
				Swal.fire({
					icon: 'success',
					title: 'Sesión cerrada',
					text: 'Has cerrado sesión correctamente.',
					confirmButtonColor: '#3f72af'
				});
			}
			if (document.getElementById("registroOk")) {
				Swal.fire({
					icon: 'success',
					title: 'Registro exitoso',
					text: 'Ahora puedes iniciar sesión.',
					confirmButtonColor: '#3f72af'
				});
			}
		});
	</script>
</body>

</html>