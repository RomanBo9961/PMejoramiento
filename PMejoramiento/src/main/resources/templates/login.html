<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Iniciar Sesión</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<style>
		/* ====== ESTILOS GENERALES ====== */
		body,
		html {
			height: 100%;
			margin: 0;
			font-family: 'Poppins', sans-serif;
			color: #fff;
			overflow: hidden;
			transition: background-color 0.5s ease, color 0.5s ease;
		}

		/* ====== VIDEO DE FONDO ====== */
		video#bg-video {
			position: fixed;
			right: 0;
			bottom: 0;
			min-width: 100%;
			min-height: 100%;
			object-fit: cover;
			z-index: -2;
			transition: filter 0.5s ease;
		}

		/* ====== CAPA OSCURA ====== */
		.overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.55);
			z-index: -1;
			transition: background 0.5s ease;
		}

		/* ====== TARJETA ====== */
		.login-card {
			background: rgba(255, 255, 255, 0.08);
			backdrop-filter: blur(12px);
			border-radius: 20px;
			box-shadow: 0 8px 30px rgba(0, 0, 0, 0.35);
			padding: 2.5rem;
			width: 100%;
			max-width: 420px;
			text-align: center;
			color: #f8f9fa;
			transition: all 0.5s ease;
		}

		.login-card h3 {
			font-weight: 700;
			margin-bottom: 1.5rem;
			color: #fff;
		}

		.form-control {
			border-radius: 10px;
			padding: 12px;
			background-color: rgba(255, 255, 255, 0.15);
			border: 1px solid rgba(255, 255, 255, 0.2);
			color: #fff;
		}

		.form-control::placeholder {
			color: #ddd;
		}

		.form-control:focus {
			box-shadow: 0 0 10px rgba(63, 114, 175, 0.4);
			border-color: #3f72af;
			background-color: rgba(255, 255, 255, 0.25);
			color: #fff;
		}

		.btn-login {
			background: rgba(128, 128, 192, 0.7);
			color: white;
			border-radius: 10px;
			border: none;
			padding: 12px;
			font-weight: 600;
			transition: all 0.3s ease;
		}

		.btn-login:hover {
			background: #2b547e;
			transform: translateY(-2px);
		}

		.text-muted a {
			color: #9ec5fe;
			text-decoration: none;
			font-weight: 500;
		}

		.text-muted a:hover {
			text-decoration: underline;
		}

		.theme-toggle {
			position: absolute;
			top: 20px;
			right: 20px;
			background: rgba(255, 255, 255, 0.3);
			border: none;
			color: #fff;
			padding: 10px;
			border-radius: 50%;
			font-size: 1.3rem;
			cursor: pointer;
			backdrop-filter: blur(8px);
			transition: all 0.3s ease;
		}

		.theme-toggle:hover {
			background: rgba(255, 255, 255, 0.3);
		}

		/* ====== MODO DÍA ====== */
		body.light-mode {
			color: #1a1a1a;
		}

		body.light-mode .overlay {
			background: rgba(255, 255, 255, 0.3);
		}

		body.light-mode .login-card {
			background: rgba(255, 255, 255, 0.05);
			color: #1a1a1a;
			box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
		}

		body.light-mode .form-control {
			background-color: rgba(255, 255, 255, 0.95);
			color: #1a1a1a;
		}

		body.light-mode .btn-login {
			background: rgba(64, 128, 128, 0.6);
		}

		body.light-mode .btn-login:hover {
			background: #394a6a;
		}
	</style>
</head>

<body>
	<!-- VIDEO DE FONDO -->
	<video autoplay muted loop id="bg-video">
		<source src="https://videos.pexels.com/video-files/34645139/14683902_2560_1440_30fps.mp4" type="video/mp4">
	</video>

	<div class="overlay"></div>

	<!-- BOTÓN MODO DÍA/NOCHE -->
	<button class="theme-toggle" id="themeToggle" title="Cambiar tema">
		<i class="bi bi-moon-stars-fill"></i>
	</button>

	<!-- TARJETA DE LOGIN -->
	<div class="d-flex justify-content-center align-items-center vh-100">
		<div class="login-card">
			<h3 class="mb-4"><i class="bi bi-shield-lock-fill me-2"></i>Acceso al Sistema</h3>

			<form method="post" th:action="@{/login}">
				<div class="mb-3">
					<input type="text" name="username" class="form-control" placeholder="Email" required>
				</div>
				<div class="mb-3">
					<input type="password" name="password" class="form-control" placeholder="Contraseña" required>
				</div>

				<button type="submit" class="btn btn-login w-100 mb-3">
					<i class="bi bi-box-arrow-in-right me-1"></i> Iniciar Sesión
				</button>

				<p class="mb-4">
					¿No tienes cuenta? <a th:href="@{/registro}" style="color: rgb(255, 255, 255);"><Strong>Regístrate
							aquí</Strong></a>
				</p>
			</form>

			<!-- Thymeleaf "flags" ocultos -->
			<input type="hidden" id="loginError" th:if="${param.error}" value="1">
			<input type="hidden" id="logoutOk" th:if="${param.logout}" value="1">
			<input type="hidden" id="registroOk" th:if="${param.registroExitoso}" value="1">
		</div>
	</div>

	<script>
		// ====== MODO DÍA / NOCHE ======
		const toggle = document.getElementById('themeToggle');
		const icon = toggle.querySelector('i');
		const body = document.body;
		const video = document.getElementById('bg-video');

		// Guardar modo en localStorage
		if (localStorage.getItem('theme') === 'light') {
			body.classList.add('light-mode');
			icon.classList.replace('bi-moon-stars-fill', 'bi-brightness-high-fill');
			video.style.filter = "brightness(1.1)";
		}

		toggle.addEventListener('click', () => {
			body.classList.toggle('light-mode');
			if (body.classList.contains('light-mode')) {
				icon.classList.replace('bi-moon-stars-fill', 'bi-brightness-high-fill');
				localStorage.setItem('theme', 'light');
				video.style.filter = "brightness(1.1)";
			} else {
				icon.classList.replace('bi-brightness-high-fill', 'bi-moon-stars-fill');
				localStorage.setItem('theme', 'dark');
				video.style.filter = "brightness(0.7)";
			}
		});

		// ====== SWEETALERT2 SEGÚN THYMELEAF ======
		document.addEventListener("DOMContentLoaded", () => {
			if (document.getElementById("loginError")) {
				Swal.fire({
					icon: 'error',
					title: 'Error de autenticación',
					text: 'Email o contraseña incorrectos.',
					confirmButtonColor: '#3f72af'
				});
			}
			if (document.getElementById("logoutOk")) {
				Swal.fire({
					icon: 'success',
					title: 'Sesión cerrada',
					text: 'Has cerrado sesión correctamente.',
					confirmButtonColor: '#3f72af'
				});
			}
			if (document.getElementById("registroOk")) {
				Swal.fire({
					icon: 'success',
					title: 'Registro exitoso',
					text: 'Ahora puedes iniciar sesión.',
					confirmButtonColor: '#3f72af'
				});
			}
		});
	</script>
</body>

</html>